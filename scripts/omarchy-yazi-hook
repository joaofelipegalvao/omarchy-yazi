#!/bin/bash
# Omarchy Yazi Theme Hook
# Automatically syncs Yazi theme when Omarchy theme changes

set -euo pipefail

readonly GENERATOR="$HOME/.local/bin/omarchy-yazi-generator"
readonly YAZI_STATE="$HOME/.local/state/yazi"

log() { echo "[omarchy-yazi] $*" >&2; }
warn() { echo "[omarchy-yazi] WARNING: $*" >&2; }

if [[ -x "$GENERATOR" ]]; then
  "$GENERATOR" "${1:-}" &>/dev/null || warn "Generator failed"
else
  warn "Generator not found at $GENERATOR"
  exit 0
fi

if [[ -d "$YAZI_STATE" ]]; then
  rm -rf "$YAZI_STATE"
  log "Cleared Yazi state cache"
fi

find "$HOME/.config/yazi" -maxdepth 1 -name "theme.toml-*" -type f -delete 2>/dev/null || true

log "Theme sync complete"
